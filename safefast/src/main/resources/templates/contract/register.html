<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/js/jquery-3.7.1.min.js"></script>
</head>
<body>
<h2>계약 등록 - 계약서</h2>
<form id="contract-form" action="/contract/register" method="POST">
    <table>
        <tr>
            <th>계약서/첨부파일</th>
            <td><input type="file"></td>
        </tr>
        <tr>
            <th>사업자 번호</th>
            <td><input type="text" name="businessNumber" class="input-field"></td>
        </tr>
        <tr>
            <th>업체명</th>
            <td><input type="text" name="companyName" class="input-field" disabled></td>
        </tr>
        <tr>
            <th>계좌 정보</th>
            <td><input type="text" name="companyAccount" class="input-field" disabled></td>
        </tr>
    </table>

    <h2>계약 등록 - 계약 항목</h2>
    <table class="save-section">
        <tr>
            <th>품목코드</th>
            <th>품목명</th>
            <th>단가</th>
            <th>L/T(일)</th>
            <th>세부사항</th>
        </tr>
        <tr>
            <td><input type="text" name="itemCode" class="input-field" disabled></td>
            <td><input type="text" name="itemName" class="input-field" disabled></td>
            <td><input type="text" name="itemPrice"></td>
            <td><input type="text" name="leadTime" ></td>
            <td><input type="text" name="note" ></td>
        </tr>
        <!-- Add more rows as needed -->
    </table>
    <button type="submit" class="save-button">저장</button>
</form>


<div class="management-section">
    <h2>계약 관리</h2>
    <div class="search-bar">
        <select name="search-option" id="search-option">
            <option value="계약번호">계약번호</option>
            <option value="품목명">품목명</option>
            <option value="업체명">업체명</option>
        </select>
        <input type="text" placeholder="품목명 검색..." class="search-input">
        <button class="search-button">검색</button>
    </div>
    <table>
        <thead>
        <tr>
            <th>계약번호</th>
            <th>품목코드</th>
            <th>품목명</th>
            <th>업체명</th>
            <th>사업자번호</th>
            <th>단가</th>
            <th>L/T(일)</th>
            <th>수정</th>
            <th>계약서</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${items}">
            <td></td>
            <td class="item-row">
                <span class="itemCode" th:text="${item.itemCode}"></span>
                <span class="itemName" th:text="${item.itemName}" style="display: none;"></span> <!-- 수정된 부분 -->
            </td>
            <td th:text="${item.itemName}"></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        </tbody>
    </table>
</div>
<script>
    $(document).ready(function () {
        // 품목 행을 클릭했을 때 해당 품목의 정보를 계약 관리 테이블에 자동으로 채우기
        $("body").on("click", ".item-row", function () {
            var contractNumber = generateContractNumber();
            var itemCode = $(this).find(".itemCode").text();
            var itemName = $(this).find(".itemName").text();
            var companyName = $(this).find(".companyName").text();
            var businessNumber = $(this).find(".businessNumber").text();
            var unitPrice = $(this).find(".unitPrice").text();
            var leadTime = $(this).find(".leadTime").text();

            // 계약 관리 테이블에 정보 채우기
            $("#contractManagementTable tbody").append(
                "<tr>" +
                "<td>" + contractNumber + "</td>" +
                "<td>" + itemCode + "</td>" +
                "<td>" + itemName + "</td>" +
                "<td>" + companyName + "</td>" +
                "<td>" + businessNumber + "</td>" +
                "<td>" + unitPrice + "</td>" +
                "<td>" + leadTime + "</td>" +
                "<td><button class='edit-button'>수정</button></td>" +
                "<td><button class='view-contract-button'>계약서</button></td>" +
                "</tr>"
            );

            $("input[name='itemCode']").val(itemCode);
            $("input[name='itemName']").val(itemName);

        });

        // 사업자 번호를 입력했을 때 해당 업체 정보를 자동으로 채우기
        $("input[name='businessNumber']").on("change", function () {
            var businessNumber = $(this).val();
            $.ajax({
                url: "/contract/company",
                method: "GET",
                data: { businessNumber: businessNumber },
                success: function (response) {
                    $("input[name='companyName']").val(response.companyName);
                    $("input[name='companyAccount']").val(response.companyAccount);
                },
                error: function () {
                    alert("업체 정보를 불러올 수 없습니다.");
                }
            });
        });

        // 계약 번호 생성 함수
        function generateContractNumber() {
            // 여기에 계약 번호 생성 로직을 구현합니다.
            // 이 부분은 실제로 사용하는 시스템에 맞게 구현되어야 합니다.
            // 임시로 현재 시간을 기반으로 한 번호를 생성하는 예시를 보여드리겠습니다.
            var currentDate = new Date();
            var year = currentDate.getFullYear();
            var month = currentDate.getMonth() + 1;
            var day = currentDate.getDate();
            var hour = currentDate.getHours();
            var minute = currentDate.getMinutes();
            var second = currentDate.getSeconds();
            var milliseconds = currentDate.getMilliseconds();
            return "CON" + year + month + day + hour + minute + second + milliseconds;
        }
    });
</script>


</body>
</html>
