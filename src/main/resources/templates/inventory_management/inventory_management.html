<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>자재 현황 관리 그래프</title>
  <link rel="stylesheet" href="/css/inventory_management.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link rel="icon" href="/image/favicon-32x32.png">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<th:block th:replace="~{/fragments/fragment1}"></th:block>
<th:block th:replace="~{/fragments/fragment3 :: subnav(currentPageName='자재 관리 > 재고(금액) 관리')}"></th:block>
  <div class="container">
      <th:block th:replace="~{/fragments/fragment2}"></th:block>
    <div class="content">
      <h2>현황 관리 그래프</h2>
      <div class="head-box">
        <div class="date-search">
          <input type="date" id="date-start" placeholder="시작 날짜"> <span>&nbsp; - &nbsp;</span> 
          <input type="date" id="date-end" placeholder="종료 날짜">
          <button id="date-search-btn">검색</button>
        </div>
        <div class="save-btn">
            <button id="issue-order-btn-large" class="button">대분류</button>
            <button id="issue-order-btn-medium" class="button">중분류</button>
            <button id="issue-order-btn-small" class="button">소분류</button>
        </div>
      </div>
        <div class="graph">
          <canvas id="myChart" width="400" height="400"></canvas>
          <canvas id="container3" width="400" height="400"></canvas>
        </div>
    </div>
  </div>


  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>


<script type="text/javascript">
  // 데이터 정의
  const categoryData = {
    large: [1200, 600, 400, 0, 800, 50],
    medium: [800, 500, 300, 200, 600, 400],
    small: [300, 200, 100, 50, 400, 300]
  };

  const labels = {
    large: ['충전부', '용접부', '취출부', '주입부', '장착부', '제어부'],
    medium: ['히터', '커넥터', '고정대', '구동축', '모터', '펌프'],
    small: ['벨트', '기어', '핀', '체인', '케이블', '볼트']
  };

  // Echarts 차트 초기화
  const echartsContainer = document.getElementById('container3');
  const myChartEcharts = echarts.init(echartsContainer, null, { renderer: 'canvas', useDirtyRect: false });

  const updateEchartsChart = (data, labels) => {
    const option = {
      xAxis: {
        type: 'category',
        data: labels,
        axisLabel: {
          interval: 0, // 모든 레이블 표시
/*          rotate: 30, */ // 필요한 경우 레이블 회전 (회전 각도는 필요에 따라 조정)
        }
      },
      yAxis: {
        type: 'value'
      },
      series: [{
        data: data,
        type: 'bar',
        showBackground: true,
        backgroundStyle: { color: 'rgba(180, 180, 180, 0.2)' }
      }]
    };

    if (option && typeof option === 'object') {
      myChartEcharts.setOption(option);
    }

    window.addEventListener('resize', myChartEcharts.resize);
  };

  // Chart.js 도넛 차트 초기화
  const ctx = document.getElementById('myChart').getContext('2d');
  const myChartDoughnut = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: labels.large,
      datasets: [{
        data: categoryData.large,
        backgroundColor: [
          'rgba(255, 99, 132, 0.8)',
          'rgba(54, 162, 235, 0.8)',
          'rgba(255, 206, 86, 0.8)',
          'rgba(75, 192, 192, 0.8)',
          'rgba(153, 102, 255, 0.8)',
          'rgba(255, 159, 64, 0.8)'
        ],
        hoverOffset: 4
      }]
    },
    options: {
      responsive: false,
      plugins: { legend: { position: 'right' } }
    }
  });

  const updateDoughnutChart = (data, labels) => {
    myChartDoughnut.data.labels = labels;
    myChartDoughnut.data.datasets[0].data = data;
    myChartDoughnut.update();
  };

  // 버튼 클릭 이벤트 핸들러
  document.getElementById('issue-order-btn-large').addEventListener('click', () => {
    updateEchartsChart(categoryData.large, labels.large);
    updateDoughnutChart(categoryData.large, labels.large);
  });

  document.getElementById('issue-order-btn-medium').addEventListener('click', () => {
    updateEchartsChart(categoryData.medium, labels.medium);
    updateDoughnutChart(categoryData.medium, labels.medium);
  });

  document.getElementById('issue-order-btn-small').addEventListener('click', () => {
    updateEchartsChart(categoryData.small, labels.small);
    updateDoughnutChart(categoryData.small, labels.small);
  });

  // 초기 차트 로드
  updateEchartsChart(categoryData.large, labels.large);
  updateDoughnutChart(categoryData.large, labels.large);
</script>

  <script src="/js/index.js"></script>
  <script src="/js/inventory_management.js"></script>
</body>
</html>